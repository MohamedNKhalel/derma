"use strict";(self.webpackChunkgraduation=self.webpackChunkgraduation||[]).push([[309],{5309:(A,b,s)=>{s.r(b),s.d(b,{AnalyticsComponent:()=>U});var O=s(6814),v=s(5861),t=s(5879),C=s(7328),z=s(7394),c=s(8645),u=s(6321),m=s(5592),f=s(9360),p=s(8251),y=s(4829),Z=s(4825);var M=s(4664);class D{constructor(){this.subject=new C.t(1),this.subscriptions=new z.w0}doFilter(r){this.subject.next(r)}dispose(){this.subscriptions.unsubscribe()}notEmpty(r,a){this.subscriptions.add(this.subject.subscribe(e=>{if(e[r]){const i=e[r].currentValue;null!=i&&a(i)}}))}has(r,a){this.subscriptions.add(this.subject.subscribe(e=>{e[r]&&a(e[r].currentValue)}))}notFirst(r,a){this.subscriptions.add(this.subject.subscribe(e=>{e[r]&&!e[r].isFirstChange()&&a(e[r].currentValue)}))}notFirstAndEmpty(r,a){this.subscriptions.add(this.subject.subscribe(e=>{if(e[r]&&!e[r].isFirstChange()){const i=e[r].currentValue;null!=i&&a(i)}}))}}const L=new t.OlP("NGX_ECHARTS_CONFIG");let P=(()=>{class n{constructor(a,e,i){this.el=e,this.ngZone=i,this.options=null,this.theme=null,this.initOpts=null,this.merge=null,this.autoResize=!0,this.loading=!1,this.loadingType="default",this.loadingOpts=null,this.chartInit=new t.vpe,this.optionsError=new t.vpe,this.chartClick=this.createLazyEvent("click"),this.chartDblClick=this.createLazyEvent("dblclick"),this.chartMouseDown=this.createLazyEvent("mousedown"),this.chartMouseMove=this.createLazyEvent("mousemove"),this.chartMouseUp=this.createLazyEvent("mouseup"),this.chartMouseOver=this.createLazyEvent("mouseover"),this.chartMouseOut=this.createLazyEvent("mouseout"),this.chartGlobalOut=this.createLazyEvent("globalout"),this.chartContextMenu=this.createLazyEvent("contextmenu"),this.chartHighlight=this.createLazyEvent("highlight"),this.chartDownplay=this.createLazyEvent("downplay"),this.chartSelectChanged=this.createLazyEvent("selectchanged"),this.chartLegendSelectChanged=this.createLazyEvent("legendselectchanged"),this.chartLegendSelected=this.createLazyEvent("legendselected"),this.chartLegendUnselected=this.createLazyEvent("legendunselected"),this.chartLegendLegendSelectAll=this.createLazyEvent("legendselectall"),this.chartLegendLegendInverseSelect=this.createLazyEvent("legendinverseselect"),this.chartLegendScroll=this.createLazyEvent("legendscroll"),this.chartDataZoom=this.createLazyEvent("datazoom"),this.chartDataRangeSelected=this.createLazyEvent("datarangeselected"),this.chartGraphRoam=this.createLazyEvent("graphroam"),this.chartGeoRoam=this.createLazyEvent("georoam"),this.chartTreeRoam=this.createLazyEvent("treeroam"),this.chartTimelineChanged=this.createLazyEvent("timelinechanged"),this.chartTimelinePlayChanged=this.createLazyEvent("timelineplaychanged"),this.chartRestore=this.createLazyEvent("restore"),this.chartDataViewChanged=this.createLazyEvent("dataviewchanged"),this.chartMagicTypeChanged=this.createLazyEvent("magictypechanged"),this.chartGeoSelectChanged=this.createLazyEvent("geoselectchanged"),this.chartGeoSelected=this.createLazyEvent("geoselected"),this.chartGeoUnselected=this.createLazyEvent("geounselected"),this.chartAxisAreaSelected=this.createLazyEvent("axisareaselected"),this.chartBrush=this.createLazyEvent("brush"),this.chartBrushEnd=this.createLazyEvent("brushend"),this.chartBrushSelected=this.createLazyEvent("brushselected"),this.chartGlobalCursorTaken=this.createLazyEvent("globalcursortaken"),this.chartRendered=this.createLazyEvent("rendered"),this.chartFinished=this.createLazyEvent("finished"),this.animationFrameID=null,this.chart$=new C.t(1),this.resize$=new c.x,this.changeFilter=new D,this.echarts=a.echarts}ngOnChanges(a){this.changeFilter.doFilter(a)}ngOnInit(){if(!window.ResizeObserver)throw new Error("please install a polyfill for ResizeObserver");this.resizeSub=this.resize$.pipe(function w(n,r=u.z,a){const e=(0,Z.H)(n,r);return function T(n,r){return(0,f.e)((a,e)=>{const{leading:i=!0,trailing:l=!1}=r??{};let d=!1,h=null,o=null,S=!1;const B=()=>{o?.unsubscribe(),o=null,l&&(x(),S&&e.complete())},I=()=>{o=null,S&&e.complete()},E=g=>o=(0,y.Xf)(n(g)).subscribe((0,p.x)(e,B,I)),x=()=>{if(d){d=!1;const g=h;h=null,e.next(g),!S&&E(g)}};a.subscribe((0,p.x)(e,g=>{d=!0,h=g,(!o||o.closed)&&(i?x():E(g))},()=>{S=!0,(!(l&&d&&o)||o.closed)&&e.complete()}))})}(()=>e,a)}(100,u.z,{leading:!1,trailing:!0})).subscribe(()=>this.resize()),this.autoResize&&(this.resizeOb=this.ngZone.runOutsideAngular(()=>new window.ResizeObserver(()=>{this.animationFrameID=window.requestAnimationFrame(()=>this.resize$.next())})),this.resizeOb.observe(this.el.nativeElement)),this.changeFilter.notFirstAndEmpty("options",a=>this.onOptionsChange(a)),this.changeFilter.notFirstAndEmpty("merge",a=>this.setOption(a)),this.changeFilter.has("loading",a=>this.toggleLoading(!!a)),this.changeFilter.notFirst("theme",()=>this.refreshChart())}ngOnDestroy(){window.clearTimeout(this.initChartTimer),this.resizeSub&&this.resizeSub.unsubscribe(),this.animationFrameID&&window.cancelAnimationFrame(this.animationFrameID),this.resizeOb&&this.resizeOb.unobserve(this.el.nativeElement),this.loadingSub&&this.loadingSub.unsubscribe(),this.changeFilter.dispose(),this.dispose()}ngAfterViewInit(){this.initChartTimer=window.setTimeout(()=>this.initChart())}dispose(){this.chart&&(this.chart.isDisposed()||this.chart.dispose(),this.chart=null)}resize(){this.chart&&this.chart.resize()}toggleLoading(a){this.chart?a?this.chart.showLoading(this.loadingType,this.loadingOpts):this.chart.hideLoading():this.loadingSub=this.chart$.subscribe(e=>a?e.showLoading(this.loadingType,this.loadingOpts):e.hideLoading())}setOption(a,e){if(this.chart)try{this.chart.setOption(a,e)}catch(i){console.error(i),this.optionsError.emit(i)}}refreshChart(){var a=this;return(0,v.Z)(function*(){a.dispose(),yield a.initChart()})()}createChart(){const a=this.el.nativeElement;if(window&&window.getComputedStyle){const e=window.getComputedStyle(a,null).getPropertyValue("height");(!e||"0px"===e)&&(!a.style.height||"0px"===a.style.height)&&(a.style.height="400px")}return this.ngZone.runOutsideAngular(()=>("function"==typeof this.echarts?this.echarts:()=>Promise.resolve(this.echarts))().then(({init:i})=>i(a,this.theme,this.initOpts)))}initChart(){var a=this;return(0,v.Z)(function*(){yield a.onOptionsChange(a.options),a.merge&&a.chart&&a.setOption(a.merge)})()}onOptionsChange(a){var e=this;return(0,v.Z)(function*(){a&&(e.chart||(e.chart=yield e.createChart(),e.chart$.next(e.chart),e.chartInit.emit(e.chart)),e.setOption(e.options,!0))})()}createLazyEvent(a){return this.chartInit.pipe((0,M.w)(e=>new m.y(i=>(e.on(a,l=>this.ngZone.run(()=>i.next(l))),()=>{this.chart&&(this.chart.isDisposed()||e.off(a))}))))}static#t=this.\u0275fac=function(e){return new(e||n)(t.Y36(L),t.Y36(t.SBq),t.Y36(t.R0b))};static#e=this.\u0275dir=t.lG2({type:n,selectors:[["echarts"],["","echarts",""]],inputs:{options:"options",theme:"theme",initOpts:"initOpts",merge:"merge",autoResize:"autoResize",loading:"loading",loadingType:"loadingType",loadingOpts:"loadingOpts"},outputs:{chartInit:"chartInit",optionsError:"optionsError",chartClick:"chartClick",chartDblClick:"chartDblClick",chartMouseDown:"chartMouseDown",chartMouseMove:"chartMouseMove",chartMouseUp:"chartMouseUp",chartMouseOver:"chartMouseOver",chartMouseOut:"chartMouseOut",chartGlobalOut:"chartGlobalOut",chartContextMenu:"chartContextMenu",chartHighlight:"chartHighlight",chartDownplay:"chartDownplay",chartSelectChanged:"chartSelectChanged",chartLegendSelectChanged:"chartLegendSelectChanged",chartLegendSelected:"chartLegendSelected",chartLegendUnselected:"chartLegendUnselected",chartLegendLegendSelectAll:"chartLegendLegendSelectAll",chartLegendLegendInverseSelect:"chartLegendLegendInverseSelect",chartLegendScroll:"chartLegendScroll",chartDataZoom:"chartDataZoom",chartDataRangeSelected:"chartDataRangeSelected",chartGraphRoam:"chartGraphRoam",chartGeoRoam:"chartGeoRoam",chartTreeRoam:"chartTreeRoam",chartTimelineChanged:"chartTimelineChanged",chartTimelinePlayChanged:"chartTimelinePlayChanged",chartRestore:"chartRestore",chartDataViewChanged:"chartDataViewChanged",chartMagicTypeChanged:"chartMagicTypeChanged",chartGeoSelectChanged:"chartGeoSelectChanged",chartGeoSelected:"chartGeoSelected",chartGeoUnselected:"chartGeoUnselected",chartAxisAreaSelected:"chartAxisAreaSelected",chartBrush:"chartBrush",chartBrushEnd:"chartBrushEnd",chartBrushSelected:"chartBrushSelected",chartGlobalCursorTaken:"chartGlobalCursorTaken",chartRendered:"chartRendered",chartFinished:"chartFinished"},exportAs:["echarts"],standalone:!0,features:[t.TTD]})}return n})();const F=n=>({provide:L,useValue:n});let R=(()=>{class n{static forRoot(a){return{ngModule:n,providers:[F(a)]}}static forChild(){return{ngModule:n}}static#t=this.\u0275fac=function(e){return new(e||n)};static#e=this.\u0275mod=t.oAB({type:n});static#a=this.\u0275inj=t.cJS({})}return n})();var G=s(2848);let U=(()=>{class n{constructor(a){this._DataService=a,this.patients=[],this.totalPatients=0,this.malePercentage=0,this.femalePercentage=0,this.avgBloodPressure=0,this.avgSugar=0,this.avgTemperature=0,this.genderChartOption={},this.ageChartOption={},this.vitalsChartOption={}}ngOnInit(){this.getAllPatients()}getAllPatients(){this._DataService.getAllPatients().subscribe(a=>{this.patients=a.map(e=>{const i=e.payload.doc.data();return{id:e.payload.doc.id,...i}}),this.calculateStats(),this.initCharts()})}calculateStats(){if(this.totalPatients=this.patients.length,0===this.totalPatients)return;const a=this.patients.filter(h=>"male"===h.gender?.toLowerCase()).length,e=this.patients.filter(h=>"female"===h.gender?.toLowerCase()).length;this.malePercentage=Math.round(a/this.totalPatients*100),this.femalePercentage=Math.round(e/this.totalPatients*100);const i=this.patients.reduce((h,o)=>h+(Number(o.rate?.bloodPressureRate)||0),0),l=this.patients.reduce((h,o)=>h+(Number(o.rate?.bloodSugarRate)||0),0),d=this.patients.reduce((h,o)=>h+(Number(o.rate?.temperature)||0),0);this.avgBloodPressure=Math.round(i/this.totalPatients),this.avgSugar=Math.round(l/this.totalPatients),this.avgTemperature=Math.round(d/this.totalPatients)}initCharts(){const a=this.patients.filter(l=>"male"===l.gender?.toLowerCase()).length,e=this.patients.filter(l=>"female"===l.gender?.toLowerCase()).length;this.genderChartOption={backgroundColor:"transparent",tooltip:{trigger:"item"},legend:{top:"5%",left:"center",textStyle:{color:"#fff"}},series:[{name:"Gender",type:"pie",radius:["40%","70%"],avoidLabelOverlap:!1,itemStyle:{borderRadius:10,borderColor:"#0a0a0f",borderWidth:2},label:{show:!1,position:"center"},emphasis:{label:{show:!0,fontSize:20,fontWeight:"bold",color:"#fff"}},labelLine:{show:!1},data:[{value:a,name:"Male",itemStyle:{color:"#3b82f6"}},{value:e,name:"Female",itemStyle:{color:"#ec4899"}}]}]};const i={"0-18":0,"19-30":0,"31-50":0,"51+":0};this.patients.forEach(l=>{const d=new Date(l.date_of_birth),h=(new Date).getFullYear()-d.getFullYear();h<=18?i["0-18"]++:h<=30?i["19-30"]++:h<=50?i["31-50"]++:i["51+"]++}),this.ageChartOption={backgroundColor:"transparent",tooltip:{trigger:"axis",axisPointer:{type:"shadow"}},grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0},xAxis:[{type:"category",data:Object.keys(i),axisTick:{alignWithLabel:!0},axisLine:{lineStyle:{color:"#94a3b8"}}}],yAxis:[{type:"value",splitLine:{lineStyle:{color:"rgba(255,255,255,0.1)"}},axisLine:{lineStyle:{color:"#94a3b8"}}}],series:[{name:"Patients",type:"bar",barWidth:"60%",data:Object.values(i),itemStyle:{color:{type:"linear",x:0,y:0,x2:0,y2:1,colorStops:[{offset:0,color:"#22d3ee"},{offset:1,color:"#6366f1"}]},borderRadius:[5,5,0,0]}}]},this.vitalsChartOption={backgroundColor:"transparent",tooltip:{},radar:{indicator:[{name:"Blood Pressure",max:200},{name:"Blood Sugar",max:300},{name:"Temperature",max:42}],axisName:{color:"#94a3b8"},splitLine:{lineStyle:{color:"rgba(255,255,255,0.1)"}},splitArea:{show:!1},axisLine:{lineStyle:{color:"rgba(255,255,255,0.1)"}}},series:[{name:"Average Vitals",type:"radar",data:[{value:[this.avgBloodPressure,this.avgSugar,this.avgTemperature],name:"Patient Averages",areaStyle:{color:"rgba(236, 72, 153, 0.2)"},lineStyle:{color:"#ec4899"},itemStyle:{color:"#ec4899"}}]}]}}static#t=this.\u0275fac=function(e){return new(e||n)(t.Y36(G.D))};static#e=this.\u0275cmp=t.Xpm({type:n,selectors:[["app-analytics"]],standalone:!0,features:[t._Bn([{provide:L,useFactory:()=>({echarts:()=>s.e(102).then(s.bind(s,9102))})}]),t.jDz],decls:69,vars:7,consts:[[1,"analytics-container","container","py-4"],[1,"mb-4"],[1,"text-primary","fw-bold"],[1,"text-muted"],[1,"row","g-4","mb-4"],[1,"col-md-3"],[1,"card","shadow","border-0","h-100","rounded-3"],[1,"card-body","d-flex","align-items-center"],[1,"icon-box","bg-light","text-primary","rounded-3","p-3","me-3"],[1,"fa-solid","fa-users","fa-2x"],[1,"mb-0","fw-bold"],[1,"text-muted","small"],[1,"icon-box","bg-light","text-danger","rounded-3","p-3","me-3"],[1,"fa-solid","fa-heart-pulse","fa-2x"],[1,"icon-box","bg-light","text-warning","rounded-3","p-3","me-3"],[1,"fa-solid","fa-droplet","fa-2x"],[1,"icon-box","bg-light","text-success","rounded-3","p-3","me-3"],[1,"fa-solid","fa-temperature-full","fa-2x"],[1,"row","g-4"],[1,"col-md-6"],[1,"card","shadow","border-0","rounded-3","h-100"],[1,"card-header","bg-white","border-bottom-0","pt-3"],[1,"fw-bold","text-dark"],[1,"card-body"],["echarts","",1,"chart-container",3,"options"],[1,"col-12"]],template:function(e,i){1&e&&(t.TgZ(0,"div",0)(1,"div",1)(2,"h1",2),t._uU(3,"Patient Analytics"),t.qZA(),t.TgZ(4,"p",3),t._uU(5,"Real-time overview of your patient population stats and health metrics."),t.qZA()(),t.TgZ(6,"div",4)(7,"div",5)(8,"div",6)(9,"div",7)(10,"div",8),t._UZ(11,"i",9),t.qZA(),t.TgZ(12,"div")(13,"h3",10),t._uU(14),t.qZA(),t.TgZ(15,"span",11),t._uU(16,"TOTAL PATIENTS"),t.qZA()()()()(),t.TgZ(17,"div",5)(18,"div",6)(19,"div",7)(20,"div",12),t._UZ(21,"i",13),t.qZA(),t.TgZ(22,"div")(23,"h3",10),t._uU(24),t.qZA(),t.TgZ(25,"span",11),t._uU(26,"AVG. BP"),t.qZA()()()()(),t.TgZ(27,"div",5)(28,"div",6)(29,"div",7)(30,"div",14),t._UZ(31,"i",15),t.qZA(),t.TgZ(32,"div")(33,"h3",10),t._uU(34),t.qZA(),t.TgZ(35,"span",11),t._uU(36,"AVG. SUGAR"),t.qZA()()()()(),t.TgZ(37,"div",5)(38,"div",6)(39,"div",7)(40,"div",16),t._UZ(41,"i",17),t.qZA(),t.TgZ(42,"div")(43,"h3",10),t._uU(44),t.qZA(),t.TgZ(45,"span",11),t._uU(46,"AVG. TEMP"),t.qZA()()()()()(),t.TgZ(47,"div",18)(48,"div",19)(49,"div",20)(50,"div",21)(51,"h5",22),t._uU(52,"Gender Distribution"),t.qZA()(),t.TgZ(53,"div",23),t._UZ(54,"div",24),t.qZA()()(),t.TgZ(55,"div",19)(56,"div",20)(57,"div",21)(58,"h5",22),t._uU(59,"Age Demographics"),t.qZA()(),t.TgZ(60,"div",23),t._UZ(61,"div",24),t.qZA()()(),t.TgZ(62,"div",25)(63,"div",20)(64,"div",21)(65,"h5",22),t._uU(66,"Health Metrics Radar"),t.qZA()(),t.TgZ(67,"div",23),t._UZ(68,"div",24),t.qZA()()()()()),2&e&&(t.xp6(14),t.Oqu(i.totalPatients),t.xp6(10),t.Oqu(i.avgBloodPressure||0),t.xp6(10),t.Oqu(i.avgSugar||0),t.xp6(10),t.Oqu(i.avgTemperature||0),t.xp6(10),t.Q6J("options",i.genderChartOption),t.xp6(7),t.Q6J("options",i.ageChartOption),t.xp6(7),t.Q6J("options",i.vitalsChartOption))},dependencies:[O.ez,R,P],styles:["[_nghost-%COMP%]{display:block}.analytics-container[_ngcontent-%COMP%]{min-height:100vh}.icon-box[_ngcontent-%COMP%]{width:60px;height:60px;display:flex;align-items:center;justify-content:center}.chart-container[_ngcontent-%COMP%]{width:100%;height:350px}.card[_ngcontent-%COMP%]{transition:transform .3s ease}.card[_ngcontent-%COMP%]:hover{transform:translateY(-5px)}"]})}return n})()},4825:(A,b,s)=>{s.d(b,{H:()=>z});var O=s(5592),v=s(6321),t=s(671);function z(c=0,u,m=v.P){let f=-1;return null!=u&&((0,t.K)(u)?m=u:f=u),new O.y(p=>{let y=function C(c){return c instanceof Date&&!isNaN(c)}(c)?+c-m.now():c;y<0&&(y=0);let T=0;return m.schedule(function(){p.closed||(p.next(T++),0<=f?this.schedule(void 0,f):p.complete())},y)})}}}]);